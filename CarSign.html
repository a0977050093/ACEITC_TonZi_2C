<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第二連軍車管理系統</title>
    <link rel="stylesheet" href="css/CarSign.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7FRW6JPXBJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7FRW6JPXBJ');
    </script>
</head>
<body>
    <div id="app">
        <h2>選擇車號與位置</h2>
        <form>
            <label for="carNumbers">選擇車號:</label>
            <select id="carNumbers">
                <optgroup label="軍E 車輛">
                    <option value="軍E-21137">軍E-21137</option>
                    <option value="軍E-21188">軍E-21188</option>
                </optgroup>
                <optgroup label="軍2 車輛">
                    <option value="軍2-20004">軍2-20004</option>
                    <option value="軍2-26681">軍2-26681</option>
                    <option value="軍2-20094">軍2-20094</option>
                    <option value="軍2-20096">軍2-20096</option>
                    <option value="軍2-20097">軍2-20097</option>
                    <option value="軍2-20895">軍2-20895</option>
                    <option value="軍2-23113">軍2-23113</option>
                    <option value="軍2-20001">軍2-20001</option>
                    <option value="軍2-20002">軍2-20002</option>
                    <option value="軍2-20009">軍2-20009</option>
                    <option value="軍2-20010">軍2-20010</option>
                    <option value="軍2-20090">軍2-20090</option>
                    <option value="軍2-20092">軍2-20092</option>
                    <option value="軍2-22705">軍2-22705</option>
                    <option value="軍2-22717">軍2-22717</option>
                    <option value="軍2-22740">軍2-22740</option>
                    <option value="軍2-22834">軍2-22834</option>
                    <option value="軍2-23836">軍2-23836</option>
                    <option value="軍2-24507">軍2-24507</option>
                    <option value="軍2-24629">軍2-24629</option>
                    <option value="軍2-24630">軍2-24630</option>
                    <option value="軍2-24631">軍2-24631</option>
                </optgroup>
                <optgroup label="軍3 車輛">
                    <option value="軍3-25088">軍3-25088</option>
                    <option value="軍3-24053">軍3-24053</option>
                </optgroup>
                <optgroup label="其他車輛">
                    <option value="軍1-23534">軍1-23534</option>
                    <option value="軍K-20456">軍K-20456</option>
                </optgroup>
            </select>

            <label for="locations">選擇位置:</label>
            <select id="locations">
                <option value="二級廠">二級廠</option>
                <option value="OK鋼棚">OK鋼棚</option>
                <option value="連側鋼棚">連側鋼棚</option>
                <option value="無線電鋼棚">無線電鋼棚</option>
                <option value="陸區鋼棚">陸區鋼棚</option>
                <option value="玄捷鋼棚">玄捷鋼棚</option>
                <option value="風雨走廊">風雨走廊</option>
                <option value="待安置車號">待安置車號</option>
            </select>

            <div class="button-group">
                <button type="button" onclick="submitCarLocation()">提交車號</button>
                <button type="button" id="status-btn" onclick="showStatus()">車況顯示</button>
            </div>
        </form>

        <div id="modal">
            <div id="modal-content" class="modal-content">
                <button class="close-btn" onclick="closeModal()">×</button>
                <h3 style="text-align: center;">車輛停放狀況</h3>
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortTable('location')">位置</th>
                            <th onclick="sortTable('carNumbers')">車號</th>
                            <th>總數</th>
                        </tr>
                    </thead>
                    <tbody id="statusTable"></tbody>
                </table>
                <div class="pagination">
                    <button onclick="prevPage()">上一頁</button>
                    <span id="pageInfo"></span>
                    <button onclick="nextPage()">下一頁</button>
                </div>
                <button type="button" class="btn-danger" onclick="clearCarNumbers()">清除所有車號</button>
            </div>
        </div>

        <div id="map-container">
            <div id="map"></div>
            <button id="reset-map-btn" onclick="resetMapView()">重置地圖視圖</button>
        </div>
        <div id="loading">正在載入...</div>
        <div id="notification" class="notification"></div>
    </div>

    <!-- Load MarkerClusterer before Google Maps API -->
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js" async defer></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhce6akuYMjY1U1qOraSCdZQKXQ9yRMQA&callback=initMap" async defer></script>
    <!-- Define initMap in global scope -->
    <script>
        let map;
        let markers = [];
        let markerCluster;
        let infoWindow;
        const defaultCenter = { lat: 24.8940207, lng: 121.2095940 };
        const defaultZoom = 17;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultCenter,
                zoom: defaultZoom,
                mapTypeId: google.maps.MapTypeId.SATELLITE,
                zoomControl: true,
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: false
            });
            infoWindow = new google.maps.InfoWindow();
            markerCluster = new MarkerClusterer({ map, markers });

            // Add a default marker at the center
            const centerMarker = new google.maps.Marker({
                position: defaultCenter,
                map: map,
                title: "軍事基地中心"
            });
            centerMarker.addListener('click', () => {
                infoWindow.setContent(`
                    <div style="color: black;">
                        <h3>軍事基地中心</h3>
                        <p>經度: ${defaultCenter.lng}, 緯度: ${defaultCenter.lat}</p>
                    </div>
                `);
                infoWindow.open(map, centerMarker);
            });
            markers.push(centerMarker);
            markerCluster.addMarker(centerMarker);
        }
    </script>
    <script src="js/CarSign.js" type="module"></script>
</body>
</html>
